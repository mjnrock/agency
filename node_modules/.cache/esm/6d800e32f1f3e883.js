let EventEmitter,uuidv4,hash;_f1f‍.x([["default",()=>Context]]);_f1f‍.w("events",[["default",["EventEmitter"],function(v){EventEmitter=v}]]);_f1f‍.w("uuid",[["v4",["uuidv4"],function(v){uuidv4=v}]]);_f1f‍.w("object-hash",[["default",["hash"],function(v){hash=v}]]);



               class Context extends EventEmitter {
    constructor(name, { state = {}, reducers = [], nodes = [] } = {}) {
        super();

        this._id = uuidv4();
        this._reducers = new Set(reducers);

        this.name = name;
        this.state = state;
        this.nodes = nodes;

        return this;
    }

    attach(...nodes) {
        for(let node of nodes) {
            this.nodes.push(node);
        }

        return this.nodes;
    }
    detach(...nodes) {
        for(let node of nodes) {
            this.nodes.delete(node);
        }

        return this.nodes;
    }
    find(nodeId) {
        for(let node of nodes) {
            if(node._id === nodeId) {
                return node;
            }
        }
    }

    add(...reducers) {
        this._reducers = new Set([
            ...this._reducers,
            ...reducers,
        ]);

        return this._reducers;
    }
    remove(...reducers) {
        for(let reducer of reducers) {
            this._reducers.delete(reducer);
        }

        return this._reducers;
    }

    run(...args) {
        for(let node of this.nodes) {
            const result = node.run(...args);

            if(result === true && this._reducers.size) {
                for(let reducer of this._reducers) {
                    if(typeof reducer === "function") {
                        this.state = reducer(this.state);
                    }
                }

                const txid = uuidv4();
                this.emit("update", this.state, txid);
                setTimeout(() => this.emit("hash", txid, hash(this.state)));
            }
        }
    }
    each(...args) {
        for(let arg of args) {
            this.run(arg);
        }

        return this;
    }
};